# Specify the physical interface to listen on for PXE requests
interface=ens224
bind-interfaces

# Declare this server as the master DHCP on this segment
dhcp-authoritative

# DHCP Range: Define start, end, mask, and lease time (12 hours)
dhcp-range=50.50.50.10,50.50.50.100,255.255.255.0,12h

# Gateway (Option 3) and DNS (Option 6)
dhcp-option=3,50.50.50.1
dhcp-option=6,50.50.50.1

# Logging: Useful for debugging PXE handshakes; disable in high-scale prod to save IO
log-dhcp

# Enable internal TFTP server and point to our boot folder
enable-tftp
tftp-root=/var/lib/tftpboot

# Architecture Detection: Identify UEFI 64-bit clients (Arch 7 and 9)
dhcp-match=set:efi64,option:client-arch,7
dhcp-match=set:efi64,option:client-arch,9

# Logic: If the client is NOT already running iPXE, send the iPXE firmware
dhcp-userclass=set:ipxe,iPXE
dhcp-boot=tag:!ipxe,tag:efi64,ipxe.efi
dhcp-boot=tag:!ipxe,tag:!efi64,undionly.kpxe

# Logic: If the client IS already running iPXE, send the boot script
dhcp-boot=tag:ipxe,boot.ipxe
